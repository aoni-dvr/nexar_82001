/**
 *  @file AmbaSensor_GC2053Table.c
 *
 *  @copyright Copyright (c) 2015 Ambarella, Inc.
 *
 *  This file and its contents ("Software") are protected by intellectual property rights including, without limitation,
 *  U.S. and/or foreign copyrights.  This Software is also the confidential and proprietary information of Ambarella, Inc.
 *  and its licensors.  You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works
 *  of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with
 *  Ambarella, Inc. or its authorized affiliates.  In the absence of such an agreement, you agree to promptly notify and
 *  return this Software to Ambarella, Inc.
 *
 *  THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 *  WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
 *  AMBARELLA, INC. OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 *  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
 *  COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 *  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 *  @details Control APIs of OmniVision GC4653 CMOS sensor with MIPI interface
 *
 */

//#include <stdio.h>
//#include <stdlib.h>
//#include <string.h>

//#include "AmbaDataType.h"
//#include "AmbaDSP.h"
#include "AmbaSensor.h"
#include "AmbaSensor_GC4653.h"

/*-----------------------------------------------------------------------------------------------*\
 * Sensor Device Information
\*-----------------------------------------------------------------------------------------------*/
const AMBA_SENSOR_DEVICE_INFO_s GC4653DeviceInfo = {
    .UnitCellWidth          = 2.0,
    .UnitCellHeight         = 2.0,
    .NumTotalPixelCols      = 2560,
    .NumTotalPixelRows      = 1440,
    .NumEffectivePixelCols  = 2560,
    .NumEffectivePixelRows  = 1440,
    .MinAnalogGainFactor    = 1.0,
    .MaxAnalogGainFactor    = 75.8,
    .MinDigitalGainFactor   = 1.0,
    .MaxDigitalGainFactor   = 16.0,

    .FrameRateCtrlInfo = {
        .CommunicationTime      = AMBA_SENSOR_COMMUNICATION_AT_NON_VBLANK,
        .FirstReflectedFrame    = 2,
        .FirstBadFrame          = 0,
        .NumBadFrames           = 0
    },
    .ShutterSpeedCtrlInfo = {
        .CommunicationTime      = AMBA_SENSOR_COMMUNICATION_AT_NON_VBLANK,
        .FirstReflectedFrame    = 2,
        .FirstBadFrame          = 0,
        .NumBadFrames           = 0
    },
    .AnalogGainCtrlInfo = {
        .CommunicationTime      = AMBA_SENSOR_COMMUNICATION_AT_NON_VBLANK,
        .FirstReflectedFrame    = 2,
        .FirstBadFrame          = 0,
        .NumBadFrames           = 0
    },
    .DigitalGainCtrlInfo = {
        .CommunicationTime      = AMBA_SENSOR_COMMUNICATION_AT_NON_VBLANK,
        .FirstReflectedFrame    = 2,
        .FirstBadFrame          = 0,
        .NumBadFrames           = 0
    },
};


/*-----------------------------------------------------------------------------------------------*\
 * Sensor register settings of each readout modes
\*-----------------------------------------------------------------------------------------------*/
GC4653_REG_s GC4653RegTable[GC4653_NUM_READOUT_MODE_REG] = {
    /*  1440P30 */
	{0x03fe,{0xf0}},
    {0x03fe,{0x00}},
    {0x0317,{0x00}},
    {0x0320,{0x77}},
    {0x0324,{0xc8}},
    {0x0325,{0x06}},
    {0x0326,{0x6c}},
    {0x0327,{0x03}},
    {0x0334,{0x40}},
    {0x0336,{0x6c}},
    {0x0337,{0x82}},
    {0x0315,{0x25}},
    {0x031c,{0xc6}},
	{0x0287,{0x18}},
    {0x0084,{0x00}},
    {0x0087,{0x50}},
    {0x029d,{0x08}},
    {0x0290,{0x00}},
	{0x033e,{0xc0}},
    {0x033f,{0x12}},
    {0x0340,{0x05}},
    {0x0341,{0xdc}},
    {0x0345,{0x06}},
    {0x034b,{0xb0}},
    {0x0352,{0x08}},
    {0x0354,{0x08}},
    {0x02d1,{0xe0}},
    {0x0223,{0xf2}},
    {0x0238,{0xa4}},
    {0x02ce,{0x7f}},
    {0x0232,{0xc4}},
    {0x02d3,{0x05}},
    {0x0243,{0x06}},
    {0x02ee,{0x30}},
    {0x026f,{0x70}},
    {0x0257,{0x09}},
    {0x0211,{0x02}},
    {0x0219,{0x09}},
    {0x023f,{0x2d}},
    {0x0518,{0x00}},
    {0x0519,{0x01}},
    {0x0515,{0x08}},
    {0x02d9,{0x3f}},
    {0x02da,{0x02}},
    {0x02db,{0xe8}},
    {0x02e6,{0x20}},
    {0x021b,{0x10}},
    {0x0252,{0x22}},
    {0x024e,{0x22}},
    {0x02c4,{0x01}},
    {0x021d,{0x17}},
    {0x024a,{0x01}},
    {0x02ca,{0x02}},
    {0x0262,{0x10}},
    {0x029a,{0x20}},
	{0x021c,{0x0e}},
	{0x0298,{0x03}},
    {0x029c,{0x00}},
    {0x027e,{0x14}},
    {0x02c2,{0x10}},
    {0x0540,{0x20}},
    {0x0546,{0x01}},
	{0x0548,{0x01}},
    {0x0544,{0x01}},
    {0x0242,{0x1b}},
    {0x02c0,{0x1b}},
    {0x02c3,{0x20}},
    {0x02e4,{0x10}},
    {0x022e,{0x00}},
    {0x027b,{0x3f}},
    {0x0269,{0x0f}},
    {0x02d2,{0x40}},
    {0x027c,{0x08}},
    {0x023a,{0x2e}},
    {0x0245,{0xce}},
    {0x0530,{0x20}},
    {0x0531,{0x02}},
    {0x0228,{0x50}},
    {0x02ab,{0x00}},
    {0x0250,{0x00}},
    {0x0221,{0x50}},
    {0x02ac,{0x00}},
    {0x02a5,{0x02}},
    {0x0260,{0x0b}},
    {0x0216,{0x04}},
    {0x0299,{0x1C}},
    {0x02bb,{0x0d}},
	{0x02a3,{0x02}},
    {0x02a4,{0x02}},
    {0x021e,{0x02}},
    {0x024f,{0x08}},
    {0x028c,{0x08}},
    {0x0532,{0x3f}},
    {0x0533,{0x02}},
    {0x0277,{0xc0}},
    {0x0276,{0xc0}},
    {0x0239,{0xc0}},
    {0x0202,{0x05}},
    {0x0203,{0xd0}},
    {0x0205,{0xc0}},
    {0x02b0,{0x68}},
    {0x0002,{0xa9}},
    {0x0004,{0x01}},
    {0x021a,{0x98}},
    {0x0266,{0xa0}},
    {0x0020,{0x01}},
    {0x0021,{0x03}},
    {0x0022,{0x00}},
    {0x0023,{0x04}},
    {0x0342,{0x06}},
    {0x0343,{0x40}},
    {0x03fe,{0x10}},
    {0x03fe,{0x00}},
    {0x0106,{0x78}},
    {0x0108,{0x0c}},
    {0x0114,{0x01}},
    {0x0115,{0x12}},
    {0x0180,{0x46}},
    {0x0181,{0x30}},
    {0x0182,{0x05}},
    {0x0185,{0x01}},
    {0x03fe,{0x10}},
    {0x03fe,{0x00}},
    {0x000f,{0x00}},
	
	{0x0100,{0x09}},
	{0x012b,{0x30}}, 
	
    {0x0080,{0x02}},
    {0x0097,{0x0a}},
    {0x0098,{0x10}},
    {0x0099,{0x05}},
    {0x009a,{0xb0}},
    {0x0317,{0x08}},
    {0x0a67,{0x80}},
    {0x0a70,{0x03}},
    {0x0a82,{0x00}},
    {0x0a83,{0x10}},
    {0x0a80,{0x2b}},
    {0x05be,{0x00}},
    {0x05a9,{0x01}},
    {0x0313,{0x80}},
    {0x05be,{0x01}},
    {0x0317,{0x00}},
	{0x0a67,{0x00}},
};

UINT8 Gc4653RegValTable[GC4653_NUM_AGC_STEP][7] = {
    {0x00,  0x00,  0x01,  0x00,  0x30,  0x1e,  0x5C},	
    {0x20,  0x00,  0x01,  0x0B,  0x30,  0x1e,  0x5C},	
    {0x01,  0x00,  0x01,  0x19,  0x30,  0x1d,  0x5B},	
    {0x21,  0x00,  0x01,  0x2A,  0x30,  0x1e,  0x5C},	
    {0x02,  0x00,  0x02,  0x00,  0x30,  0x1e,  0x5C},	
    {0x22,  0x00,  0x02,  0x17,  0x30,  0x1d,  0x5B},	
    {0x03,  0x00,  0x02,  0x33,  0x20,  0x16,  0x54},	
    {0x23,  0x00,  0x03,  0x14,  0x20,  0x17,  0x55},	
    {0x04,  0x00,  0x04,  0x00,  0x20,  0x17,  0x55},	
    {0x24,  0x00,  0x04,  0x2F,  0x20,  0x19,  0x57},	
    {0x05,  0x00,  0x05,  0x26,  0x20,  0x19,  0x57},	
    {0x25,  0x00,  0x06,  0x28,  0x20,  0x1b,  0x59},	
    {0x0c,  0x00,  0x08,  0x00,  0x20,  0x1d,  0x5B},	
    {0x2C,  0x00,  0x09,  0x1E,  0x20,  0x1f,  0x5D},	
    {0x0D,  0x00,  0x0B,  0x0C,  0x20,  0x21,  0x5F},	
    {0x2D,  0x00,  0x0D,  0x11,  0x20,  0x24,  0x62},	
    {0x1C,  0x00,  0x10,  0x00,  0x20,  0x26,  0x64},	
    {0x3C,  0x00,  0x12,  0x3D,  0x18,  0x2a,  0x68},	
    {0x5C,  0x00,  0x16,  0x19,  0x18,  0x2c,  0x6A},	
    {0x7C,  0x00,  0x1A,  0x22,  0x18,  0x2e,  0x6C},	
    {0x9C,  0x00,  0x20,  0x00,  0x18,  0x32,  0x70},	
    {0xBC,  0x00,  0x25,  0x3A,  0x18,  0x35,  0x73},	
    {0xDC,  0x00,  0x2C,  0x33,  0x10,  0x36,  0x74},	
    {0xFC,  0x00,  0x35,  0x05,  0x10,  0x38,  0x76},	
    {0x1C,  0x01,  0x40,  0x00,  0x10,  0x3c,  0x7A},	
    {0x3C,  0x01,  0x4B,  0x35,  0x10,  0x42,  0x80},
};
						
UINT32 Gc4653GainLevelTable[GC4653_NUM_AGC_STEP+1] = {
   64,
   75,
   89,
   106,
   128,
   151,
   179,
   212,
   256,
   303,
   358,
   424,
   512,
   606,
   716,
   849,
   1024,
   1213,
   1433,
   1698,
   2048,
   2426,
   2867,
   3397,
   4096,
   4853,
   0xffffffff,
};


const AMBA_SENSOR_INPUT_INFO_s GC4653InputInfo[] = {
/* GC4653_2560_1440_30P     */ {{0, 0, 2560, 1440}, { AMBA_SENSOR_SUBSAMPLE_NORMAL, 1, 1}, { AMBA_SENSOR_SUBSAMPLE_NORMAL, 1, 1}, 1},
};

const AMBA_SENSOR_OUTPUT_INFO_s GC4653OutputInfo[] = {
/* GC4653_2560_1440_30P      */ { 648000000, 2, 10, AMBA_SENSOR_BAYER_PATTERN_GR, 2560, 1440, { 0, 0, 2560, 1440}, {0}},
};

GC4653_MODE_INFO_s GC4653ModeInfoList[AMBA_SENSOR_GC4653_NUM_MODE] = {
/* AMBA_SENSOR_GC4653_2560_1440_30P     */ { GC4653_2560_1440_30P,     {24000000, 4800, 1500, { .Interlace = 0, .TimeScale =  30000, .NumUnitsInTick = 1000}}},
};
