/**
 *  @file AmbaSensor_IMX415Table.c
 *
 *  Copyright (c) 2020 Ambarella International LP
 *
 *  This file and its contents ("Software") are protected by intellectual
 *  property rights including, without limitation, U.S. and/or foreign
 *  copyrights. This Software is also the confidential and proprietary
 *  information of Ambarella International LP and its licensors. You may not use, reproduce,
 *  disclose, distribute, modify, or otherwise prepare derivative works of this
 *  Software or any portion thereof except pursuant to a signed license agreement
 *  or nondisclosure agreement with Ambarella International LP or its authorized affiliates.
 *  In the absence of such an agreement, you agree to promptly notify and return
 *  this Software to Ambarella International LP.
 *  
 *  This file includes sample code and is only for internal testing and evaluation.  If you 
 *  distribute this sample code (whether in source, object, or binary code form), it will be 
 *  without any warranty or indemnity protection from Ambarella International LP or its affiliates.
 *  
 *  THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
 *  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,
 *  MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 *  IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT,
 *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 *  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 *  LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS
 *  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 *  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 *  POSSIBILITY OF SUCH DAMAGE.
 *
 *  @details Control APIs of SONY IMX415 CMOS sensor with MIPI interface
 *
 */

#include "AmbaSensor.h"
#include "AmbaSensor_IMX415.h"

/*-----------------------------------------------------------------------------------------------*\
 * Sensor Device Information
\*-----------------------------------------------------------------------------------------------*/
const AMBA_SENSOR_DEVICE_INFO_s IMX415DeviceInfo = {
    .UnitCellWidth          = (FLOAT)1.45,
    .UnitCellHeight         = (FLOAT)1.45,
    .NumTotalPixelCols      = 3840,
    .NumTotalPixelRows      = 2160,
    .NumEffectivePixelCols  = 3840,
    .NumEffectivePixelRows  = 2160,
    .MinAnalogGainFactor    = 1.0,
    .MaxAnalogGainFactor    = (FLOAT)3981.070801,  /* 72 dB */
    .MinDigitalGainFactor   = 1.0f,
    .MaxDigitalGainFactor   = 1.0f,

    .FrameRateCtrlInfo = {
        .CommunicationTime      = AMBA_SENSOR_COMMUNICATION_AT_NON_VBLANK,
        .FirstReflectedFrame    = 2,
        .FirstBadFrame          = 0,
        .NumBadFrames           = 0
    },
    .ShutterSpeedCtrlInfo = {
        .CommunicationTime      = AMBA_SENSOR_COMMUNICATION_AT_NON_VBLANK,
        .FirstReflectedFrame    = 2,
        .FirstBadFrame          = 0,
        .NumBadFrames           = 0
    },
    .AnalogGainCtrlInfo = {
        .CommunicationTime      = AMBA_SENSOR_COMMUNICATION_AT_NON_VBLANK,
        .FirstReflectedFrame    = 2,
        .FirstBadFrame          = 0,
        .NumBadFrames           = 0
    },
};

/*-----------------------------------------------------------------------------------------------*\
 * Sensor register settings of each readout modes
\*-----------------------------------------------------------------------------------------------*/
IMX415_MODE_REG_s IMX415ModeRegTable[IMX415_NUM_READOUT_MODE_REG] = {
    /* Addr,  Full,  */
    {0x3001, {0x00, 0x00, 0x00, 0x00, 0x00}}, //BCWAIT_TIME
    {0x3003, {0x00, 0x00, 0x00, 0x00, 0x00}}, //CPWAIT_TIME
    {0x3008, {0x7F, 0x7F, 0x7F, 0x7F, 0x7F}}, //[7:0] VMAX
    {0x3009, {0x00, 0x00, 0x00, 0x00, 0x00}}, //[15:8] VMAX
    {0x300A, {0x5B, 0x5B, 0x5B, 0x5B, 0x5B}}, //[7:0] HMAX
    {0x300B, {0xA0, 0xA0, 0xA0, 0xA0, 0xA0}}, //[15:8] HMAX
    {0x301C, {0x04, 0x00, 0x00, 0x00, 0x00}}, 
    {0x301D, {0x08, 0x08, 0x08, 0x08, 0x08}},
    {0x3020, {0x00, 0x00, 0x00, 0x01, 0x00}},//
    {0x3021, {0x00, 0x00, 0x00, 0x01, 0x00}},//
    {0x3022, {0x00, 0x00, 0x00, 0x01, 0x00}},//
    {0x3023, {0x01, 0x01, 0x01, 0x01, 0x01}},//
    {0x3024, {0xCA, 0xCA, 0xCA, 0xCA, 0xCA}}, //
    {0x3025, {0x08, 0x08, 0x08, 0x08, 0x08}}, //
    {0x3026, {0x00, 0x00, 0x00, 0x00, 0x00}}, //
    {0x3028, {0x4C, 0x4C, 0x26, 0x4C, 0x28}}, //
    {0x3029, {0x04, 0x04, 0x02, 0x04, 0x05}}, //
    {0x302C, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x302D, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3030, {0x00, 0x00, 0x00, 0x00, 0x00}},//
    {0x3031, {0x01, 0x01, 0x00, 0x00, 0x01}},//
    {0x3032, {0x01, 0x01, 0x00, 0x01, 0x01}}, //necessary to set p31-36 red color
    {0x3033, {0x05, 0x05, 0x08, 0x05, 0x05}},//
    {0x3040, {0xCC, 0x00, 0x00, 0x00, 0x00}},
    {0x3041, {0x03, 0x00, 0x00, 0x00, 0x00}},
    {0x3042, {0x80, 0x18, 0x18, 0x18, 0x18}}, //[7:0]  ADBIT1
    {0x3043, {0x07, 0x0F, 0x0F, 0x0F, 0x0F}}, //[0]
    {0x3044, {0x58, 0x18, 0x18, 0x18, 0x18}},//
    {0x3045, {0x04, 0x0F, 0x0F, 0x0F, 0x0F}},
    {0x3046, {0x70, 0x20, 0x20, 0x20, 0x20}},
    {0x3047, {0x08, 0x11, 0x11, 0x11, 0x11}},
    {0x3050, {0x08, 0x08, 0x08, 0x08, 0x08}},
    {0x3051, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3052, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3054, {0x19, 0x19, 0x19, 0x19, 0x19}},
    {0x3055, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3056, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3058, {0x3E, 0x3E, 0x3E, 0x3E, 0x3E}},
    {0x3059, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x305A, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x305C, {0x66, 0x66, 0x66, 0x66, 0x66}},
    {0x305D, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x305E, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3060, {0x25, 0x25, 0x25, 0x25, 0x25}},
    {0x3061, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3062, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3064, {0x4A, 0x4A, 0x4A, 0x4A, 0x4A}},
    {0x3065, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3066, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3090, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3091, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3092, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3093, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3094, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3095, {0x00, 0x00, 0x00, 0x00, 0x00}},
                                          
	{0x30C0, {0x2A, 0x2A, 0x2A, 0x2A, 0x2A}},
    {0x30C1, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x30CC, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x30CD, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x30CF, {0x00, 0x00, 0x00, 0x00, 0x00}},//
    {0x30D9, {0x06, 0x06, 0x06, 0x06, 0x06}},//
	{0x30DA, {0x02, 0x02, 0x02, 0x02, 0x02}},//
    {0x30E2, {0x32, 0x32, 0x32, 0x32, 0x32}},//
    {0x30E3, {0x00, 0x00, 0x00, 0x00, 0x00}},//
    {0x3115, {0x00, 0x00, 0x00, 0x00, 0x00}},//
    {0x3116, {0x24, 0x24, 0x24, 0x24, 0x24}},//
    {0x3118, {0xC0, 0xC0, 0xA0, 0xC0, 0xC0}},//
    {0x3119, {0x00, 0x00, 0x00, 0x00, 0x00}},//
    {0x311A, {0xE0, 0xE0, 0xE0, 0xE0, 0xE0}},//
    {0x311B, {0x00, 0x00, 0x00, 0x00, 0x00}},//
    {0x311E, {0x24, 0x24, 0x24, 0x24, 0x24}},//
    {0x3260, {0x01, 0x01, 0x01, 0x01, 0x01}},//
    {0x32C8, {0x01, 0x01, 0x01, 0x01, 0x01}},//
                                          
    {0x32D4, {0x21, 0x21, 0x21, 0x21, 0x21}},
    {0x32EC, {0xA1, 0xA1, 0xA1, 0xA1, 0xA1}},
    {0x3452, {0x7F, 0x7F, 0x7F, 0x7F, 0x7F}},
    {0x3453, {0x03, 0x03, 0x03, 0x03, 0x03}},
    {0x358A, {0x04, 0x04, 0x04, 0x04, 0x04}},
    {0x35A1, {0x02, 0x02, 0x02, 0x02, 0x02}},
    {0x36BC, {0x0C, 0x0C, 0x0C, 0x0C, 0x0C}},
    {0x36CC, {0x53, 0x53, 0x53, 0x53, 0x53}},
    {0x36CD, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x36CE, {0x3C, 0x3C, 0x3C, 0x3C, 0x3C}},
    {0x36D0, {0x8C, 0x8C, 0x8C, 0x8C, 0x8C}},
    {0x36D1, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x36D2, {0x71, 0x71, 0x71, 0x71, 0x71}},
    {0x36D4, {0x3C, 0x3C, 0x3C, 0x3C, 0x3C}},
    {0x36D6, {0x53, 0x53, 0x53, 0x53, 0x53}},
    {0x36D7, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x36D8, {0x71, 0x71, 0x71, 0x71, 0x71}},
    {0x36DA, {0x8C, 0x8C, 0x8C, 0x8C, 0x8C}},
    {0x36DB, {0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3701, {0x03, 0x03, 0x00, 0x03, 0x03}},
	{0x3724, {0x02, 0x02, 0x02, 0x02, 0x02}},
	{0x3726, {0x02, 0x02, 0x02, 0x02, 0x02}},
	{0x3732, {0x02, 0x02, 0x02, 0x02, 0x02}},
	{0x3734, {0x03, 0x03, 0x03, 0x03, 0x03}},
	{0x3736, {0x03, 0x03, 0x03, 0x03, 0x03}},
	{0x3742, {0x03, 0x03, 0x03, 0x03, 0x03}},
	{0x3862, {0xE0, 0xE0, 0xE0, 0xE0, 0xE0}},
	{0x38CC, {0x30, 0x30, 0x30, 0x30, 0x30}},
	{0x38CD, {0x2F, 0x2F, 0x2F, 0x2F, 0x2F}},
	{0x395C, {0x0C, 0x0C, 0x0C, 0x0C, 0x0C}},
	{0x3A42, {0xD1, 0xD1, 0xD1, 0xD1, 0xD1}},
	{0x3A4C, {0x77, 0x77, 0x77, 0x77, 0x77}},
	{0x3AE0, {0x02, 0x02, 0x02, 0x02, 0x02}},
	{0x3AEC, {0x0C, 0x0C, 0x0C, 0x0C, 0x0C}},
	{0x3B00, {0x2E, 0x2E, 0x2E, 0x2E, 0x2E}},
	{0x3B06, {0x29, 0x29, 0x29, 0x29, 0x29}},
	{0x3B98, {0x25, 0x25, 0x25, 0x25, 0x25}},
	{0x3B99, {0x21, 0x21, 0x21, 0x21, 0x21}},
	{0x3B9B, {0x13, 0x13, 0x13, 0x13, 0x13}},
	{0x3B9C, {0x13, 0x13, 0x13, 0x13, 0x13}},
	{0x3B9D, {0x13, 0x13, 0x13, 0x13, 0x13}},
	{0x3B9E, {0x13, 0x13, 0x13, 0x13, 0x13}},
	{0x3BA1, {0x00, 0x00, 0x00, 0x00, 0x00}},
	{0x3BA2, {0x06, 0x06, 0x06, 0x06, 0x06}},
	{0x3BA3, {0x0B, 0x0B, 0x0B, 0x0B, 0x0B}},
	{0x3BA4, {0x10, 0x10, 0x10, 0x10, 0x10}},
	{0x3BA5, {0x14, 0x14, 0x14, 0x14, 0x14}},
	{0x3BA6, {0x18, 0x18, 0x18, 0x18, 0x18}},
	{0x3BA7, {0x1A, 0x1A, 0x1A, 0x1A, 0x1A}},
	{0x3BA8, {0x1A, 0x1A, 0x1A, 0x1A, 0x1A}},
	{0x3BA9, {0x1A, 0x1A, 0x1A, 0x1A, 0x1A}},
	{0x3BAC, {0xED, 0xED, 0xED, 0xED, 0xED}},
	{0x3BAD, {0x01, 0x01, 0x01, 0x01, 0x01}},
	{0x3BAE, {0xF6, 0xF6, 0xF6, 0xF6, 0xF6}},
	{0x3BAF, {0x02, 0x02, 0x02, 0x02, 0x02}},
	{0x3BB0, {0xA2, 0xA2, 0xA2, 0xA2, 0xA2}},
	{0x3BB1, {0x03, 0x03, 0x03, 0x03, 0x03}},
	{0x3BB2, {0xE0, 0xE0, 0xE0, 0xE0, 0xE0}},
	{0x3BB3, {0x03, 0x03, 0x03, 0x03, 0x03}},
	{0x3BB4, {0xE0, 0xE0, 0xE0, 0xE0, 0xE0}},
	{0x3BB5, {0x03, 0x03, 0x03, 0x03, 0x03}},
	{0x3BB6, {0xE0, 0xE0, 0xE0, 0xE0, 0xE0}},
	{0x3BB7, {0x03, 0x03, 0x03, 0x03, 0x03}},
	{0x3BB8, {0xE0, 0xE0, 0xE0, 0xE0, 0xE0}},
	{0x3BBA, {0xE0, 0xE0, 0xE0, 0xE0, 0xE0}},
	{0x3BBC, {0xDA, 0xDA, 0xDA, 0xDA, 0xDA}},
	{0x3BBE, {0x88, 0x88, 0x88, 0x88, 0x88}},
	{0x3BC0, {0x44, 0x44, 0x44, 0x44, 0x44}},
	{0x3BC2, {0x7B, 0x7B, 0x7B, 0x7B, 0x7B}},
	{0x3BC4, {0xA2, 0xA2, 0xA2, 0xA2, 0xA2}},
	{0x3BC8, {0xBD, 0xBD, 0xBD, 0xBD, 0xBD}},
	{0x3BCA, {0xBD, 0xBD, 0xBD, 0xBD, 0xBD}},
	{0x4000, {0x10, 0x10, 0x10, 0x10, 0x10}},//
	{0x4001, {0x03, 0x03, 0x03, 0x03, 0x03}},//
	{0x4004, {0x48, 0x48, 0x48, 0x48, 0x48}},//
	{0x4005, {0x09, 0x09, 0x09, 0x09, 0x09}},//
	{0x400C, {0x00, 0x00, 0x01, 0x00, 0x00}},//
	{0x4018, {0x7F, 0x7F, 0xA7, 0x7F, 0x7F}},//
	{0x4019, {0x00, 0x00, 0x00, 0x00, 0x00}},//
	{0x401A, {0x37, 0x37, 0x57, 0x37, 0x37}},//
	{0x401B, {0x00, 0x00, 0x00, 0x00, 0x00}},//
	{0x401C, {0x37, 0x37, 0x5F, 0x37, 0x37}},//
	{0x401D, {0x00, 0x00, 0x00, 0x00, 0x00}},//
	{0x401E, {0xF7, 0xF7, 0x97, 0xF7, 0xF7}},//
	{0x401F, {0x00, 0x00, 0x01, 0x00, 0x00}},//
	{0x4020, {0x3F, 0x3F, 0x5F, 0x3F, 0x3F}},//
	{0x4021, {0x00, 0x00, 0x00, 0x00, 0x00}},//
	{0x4022, {0x6F, 0x6F, 0xAF, 0x6F, 0x6F}},//
	{0x4023, {0x00, 0x00, 0x00, 0x00, 0x00}},//
	{0x4024, {0x3F, 0x3F, 0x5F, 0x3F, 0x3F}},//
	{0x4025, {0x00, 0x00, 0x00, 0x00, 0x00}},//
	{0x4026, {0x5F, 0x5F, 0x9F, 0x5F, 0x5F}},//
	{0x4027, {0x00, 0x00, 0x00, 0x00, 0x00}},//
	{0x4028, {0x2F, 0x2F, 0x4F, 0x2F, 0x2F}},//
	{0x4029, {0x00, 0x00, 0x00, 0x00, 0x00}},//
	{0x4074, {0x01, 0x01, 0x00, 0x01, 0x01}},//	
};

const AMBA_SENSOR_OUTPUT_INFO_s IMX415OutputInfo[IMX415_NUM_READOUT_MODE] = {
/*IMX415_1920_1080_30P */           {891000000, 4, 12, AMBA_SENSOR_BAYER_PATTERN_GB, 1920, 1080, { 0, 0, 1920, 1080}, {0}},
/*IMX415_3840_2160_30P */           {891000000, 4, 12, AMBA_SENSOR_BAYER_PATTERN_GB, 3840, 2160, { 0, 0, 3840, 2160}, {0}},
/*IMX415_3840_2160_60P */           {1485000000, 4, 10, AMBA_SENSOR_BAYER_PATTERN_GB, 3840, 2160, { 0, 0, 3840, 2160}, {0}},
/*IMX415_1920_1080_30P_BINNING */   {891000000, 4, 12, AMBA_SENSOR_BAYER_PATTERN_GB, 1920, 1080, { 0, 0, 1920, 1080}, {0}},
/*IMX415_3840_2160_25P */           {891000000, 4, 12, AMBA_SENSOR_BAYER_PATTERN_GB, 3840, 2160, { 0, 0, 3840, 2160}, {0}},
};

const AMBA_SENSOR_INPUT_INFO_s IMX415InputInfoNormalReadout[IMX415_NUM_READOUT_MODE] = {
/*IMX415_1920_1080_30P */           {{   0,   0, 3840, 2160}, {  AMBA_SENSOR_SUBSAMPLE_NORMAL, 1, 1}, {  AMBA_SENSOR_SUBSAMPLE_NORMAL, 1,  1}, 1},
/*IMX415_3840_2160_30P */           {{   0,   0, 3840, 2160}, {  AMBA_SENSOR_SUBSAMPLE_NORMAL, 1, 1}, {  AMBA_SENSOR_SUBSAMPLE_NORMAL, 1,  1}, 1},
/*IMX415_3840_2160_60P */           {{   0,   0, 3840, 2160}, {  AMBA_SENSOR_SUBSAMPLE_NORMAL, 1, 1}, {  AMBA_SENSOR_SUBSAMPLE_NORMAL, 1,  1}, 1},
/*IMX415_1920_1080_30P_BINNING */   {{   0,   0, 3840, 2160}, {  AMBA_SENSOR_SUBSAMPLE_BINNING, 1, 2}, {  AMBA_SENSOR_SUBSAMPLE_BINNING, 1,  2}, 1},
/*IMX415_3840_2160_25P */           {{   0,   0, 3840, 2160}, {  AMBA_SENSOR_SUBSAMPLE_NORMAL, 1, 1}, {  AMBA_SENSOR_SUBSAMPLE_NORMAL, 1,  1}, 1},
};

IMX415_MODE_INFO_s IMX415ModeInfoList[AMBA_SENSOR_IMX415_NUM_MODE] = {
/*AMBA_SENSOR_IMX415_1920_1080_30P */           { (IMX415_READOUT_MODE_e)AMBA_SENSOR_IMX415_1920_1080_30P, { 37125000, 1100, 1, 2250, { .Interlace = 0, .TimeScale = 30000,  .NumUnitsInTick = 1000}},0.0f}, //1H=2*XHS
/*AMBA_SENSOR_IMX415_3840_2160_30P */           { (IMX415_READOUT_MODE_e)AMBA_SENSOR_IMX415_3840_2160_30P, { 37125000, 1100, 1, 2250, { .Interlace = 0, .TimeScale = 30000,  .NumUnitsInTick = 1000}},0.0f}, //1H=2*XHS
/*AMBA_SENSOR_IMX415_3840_2160_30P */           { (IMX415_READOUT_MODE_e)AMBA_SENSOR_IMX415_3840_2160_60P, { 37125000,  550, 1, 2250, { .Interlace = 0, .TimeScale = 60000,  .NumUnitsInTick = 1000}},0.0f}, //1H=2*XHS
/*AMBA_SENSOR_IMX415_1920_1080_30P_BINNING */   { (IMX415_READOUT_MODE_e)AMBA_SENSOR_IMX415_1920_1080_30P_BINNING, { 37125000, 1100, 1, 2250, { .Interlace = 0, .TimeScale = 30000,  .NumUnitsInTick = 1000}},0.0f}, //1H=2*XHS
/*AMBA_SENSOR_IMX415_3840_2160_25P */           { (IMX415_READOUT_MODE_e)AMBA_SENSOR_IMX415_3840_2160_25P, { 37125000, 1320, 1, 2250, { .Interlace = 0, .TimeScale = 25000,  .NumUnitsInTick = 1000}},0.0f}, //1H=2*XHS
};
